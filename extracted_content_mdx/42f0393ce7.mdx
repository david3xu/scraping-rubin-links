Skip to content

## Navigation Menu

Toggle navigation

Sign in 

  * Product 

    * Actions

Automate any workflow 

    * Packages

Host and manage packages 

    * Security

Find and fix vulnerabilities 

    * Codespaces

Instant dev environments 

    * GitHub Copilot

Write better code with AI 

    * Code review

Manage code changes 

    * Issues

Plan and track work 

    * Discussions

Collaborate outside of code 

Explore
    * All features 
    * Documentation 
    * GitHub Skills 
    * Blog 

  * Solutions 

By size
    * Enterprise 
    * Teams 
    * Startups 

By industry
    * Healthcare 
    * Financial services 
    * Manufacturing 

By use case
    * CI/CD & Automation 
    * DevOps 
    * DevSecOps 

  * Resources 

Topics
    * AI 
    * DevOps 
    * Security 
    * Software Development 

Explore
    * Learning Pathways 
    * White papers, Ebooks, Webinars 
    * Customer Stories 
    * Partners 

  * Open Source 

    * GitHub Sponsors

Fund open source developers 

    * The ReadME Project

GitHub community articles 

Repositories
    * Topics 
    * Trending 
    * Collections 

  * Enterprise 

    * Enterprise platform

AI-powered developer platform 

Available add-ons
    * Advanced Security

Enterprise-grade security features 

    * GitHub Copilot

Enterprise-grade AI features 

    * Premium Support

Enterprise-grade 24/7 support 

  * Pricing



Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search 

Clear




Search syntax tips 

#  Provide feedback 

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

Cancel  Submit feedback 

#  Saved searches 

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our documentation. 

Cancel  Create saved search 

Sign in 

Sign up  Reseting focus

You signed in with another tab or window. Reload to refresh your session. You signed out in another tab or window. Reload to refresh your session. You switched accounts on another tab or window. Reload to refresh your session. Dismiss alert

{{ message }}

rubin-dp0  / **tutorial-notebooks ** Public

  * Notifications  You must be signed in to change notification settings
  * Fork 16
  * Star  31




  * Code
  * Issues 0
  * Pull requests 2
  * Actions
  * Projects 0
  * Security
  * Insights



Additional navigation options

  * Code 
  * Issues 
  * Pull requests 
  * Actions 
  * Projects 
  * Security 
  * Insights 



## Commit

Permalink

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Updated DP03 NB01 for changes in DP0.3 tables 

Browse files Browse the repository at this point in the history

  * Loading branch information



DouglasLeeTucker committed Jul 28, 2023

1 parent c1a18fc commit 0ef6550

Showing **1 changed file** with **67 additions** and **61 deletions**. 

  * Whitespace
  * Ignore whitespace



  * Split
  * Unified



##  There are no files selected for viewing 

128 changes: 67 additions & 61 deletions  128  DP03_01_Introduction_to_DP03.ipynb

Show comments 

View file  Edit file  Delete file 

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters

Show hidden characters 

Original file line number Diff line number Diff line change  
Expand Up @@ -8,7 +8,7 @@  
"<img align=\"left\" src = https://project.lsst.org/sites/default/files/Rubin-O-Logo_0.png width=250 style=\"padding: 10px\"> \n",  
"<br><b>Introduction to the DP0.3</b> <br>\n",  
"Contact author(s): Bob Abel, Douglas Tucker, and Melissa Graham<br>\n",  
"Last verified to run: 2023-07-12 <br>\n",  
"Last verified to run: 2023-07-28 <br>\n",  
"LSST Science Piplines version: Weekly 2023_21 <br>\n",  
"Container size: medium <br>\n",  
"Targeted learning level: beginner <br>"  
Expand Down Expand Up @@ -51,7 +51,8 @@  
"id": "8740f32b-3d92-4c10-8d88-46e600a63a96",  
"metadata": {},  
"source": [  
"**Credit:**\n",  
"**Credit:** The DP0.3 data set was generated by members of the Rubin Solar System Pipelines and Commissioning teams, with help from the LSST Solar System Science Collaboration, in particular: Pedro Bernardinelli, Jake Kurlander, Joachim Moeyens, Samuel Cornwall, Ari Heinze, Steph Merritt, Lynne Jones, Siegfried Eggl, Meg Schwamb, and Mario Juric.\n",  
"\n",  
"Mario JuriÄ‡ provided essential assistance in the initial stages of creating this notebook. The notebook authors would also like to acknowledge help from Leanne Guy, Pedro Bernardinelli, Sarah Greenstreet, Megan Schwamb, Brian Rogers, Niall McElroy, and Jake Vanderplass, among others."  
]  
},  
Expand Down Expand Up @@ -81,7 +82,9 @@  
"\n",  
"In Rubin Operations, these tables would be constantly changing, updated every day with the results of\n",  
"the previous night's observations.\n",  
"However, for DP0.3, a static 10-year catalog has been simulated."  
"However, for DP0.3, both a static 1-year catalog and a static 10-year catalog have been simulated.\n",  
"\n",  
"> **Notice:** To re-iterate, for DP0.3, there are tables available for both the 1-year and 10-year catalogs. For the remainder of this notebook, though, unless otherwise noted, we will just consider the tables for the 10-year catalog. Users are encouraged to explore the tables for the 1-year catalog on their own.\n"  
]  
},  
{  
Expand All @@ -106,7 +109,6 @@  
"import numpy as np\n",  
"import matplotlib.pyplot as plt\n",  
"from matplotlib import colormaps\n",  
"from matplotlib.patches import Rectangle\n",  
"import pandas as pd\n",  
"from lsst.rsp import get_tap_service"  
]  
Expand Down Expand Up @@ -196,7 +198,7 @@  
"outputs": [],  
"source": [  
"query = \"SELECT * FROM tap_schema.tables \" \\\\\n",  
" \"WHERE tap_schema.tables.schema_name = 'dp03_catalogs' \" \\\\\n",  
" \"WHERE tap_schema.tables.schema_name LIKE 'dp03_catalogs%' \" \\\\\n",  
" \"ORDER BY table_index ASC\"\n",  
"results = service.search(query).to_table()\n",  
"results"  
Expand All @@ -221,6 +223,8 @@  
"\n",  
"> **Notice:** The MPC contains all reported moving objects in the Solar System, and is not limited to those detected by LSST. Thus, the `MPCORB` table will have more rows than the `SSObject` table.\n",  
"\n",  
"> **Notice:** For DP0.3, the MPC did not actually recompute orbital elements by incorporating on the simulated LSST data, but rather vice versa: LSST observations were simulated based on the MPC's orbital elements. Thus, the `MPCORB` table can be considered a truth table.\n",  
"\n",  
"For more information about Rubin's plans for Solar System Processing, see Section 3.2.2 of the \n",  
"<a href=\"https://docushare.lsstcorp.org/docushare/dsweb/Get/LSE-163/LSE-163_DataProductsDefinitionDocumentDPDD.pdf\">Data Products Definitions Document</a>.\n",  
"Note that there remain differences between Table 4 of the DPDD, which contain the anticipated schema \n",  
Expand All @@ -246,7 +250,7 @@  
},  
"outputs": [],  
"source": [  
"results = service.search(\"SELECT COUNT(*) FROM dp03_catalogs.MPCORB\")\n",  
"results = service.search(\"SELECT COUNT(*) FROM dp03_catalogs_10yr.MPCORB\")\n",  
"results.to_table()"  
]  
},  
Expand All @@ -255,7 +259,7 @@  
"id": "1dfddcd0-0a73-4f41-9324-2fc590bb0fbf",  
"metadata": {},  
"source": [  
"There are 14.6 million rows in the `MPCORB` table."  
"There are 14.5 million rows in the `MPCORB` table."  
]  
},  
{  
Expand All @@ -281,7 +285,7 @@  
"source": [  
"results = service.search(\"SELECT column_name, datatype, description, \"\n",  
" \" unit from TAP_SCHEMA.columns \"\n",  
" \"WHERE table_name = 'dp03_catalogs.MPCORB'\")\n",  
" \"WHERE table_name = 'dp03_catalogs_10yr.MPCORB'\")\n",  
"results.to_table().to_pandas()"  
]  
},  
Expand Down Expand Up @@ -334,7 +338,7 @@  
"outputs": [],  
"source": [  
"results = service.search(\"SELECT min(ssObjectId), max(ssObjectId)\"\n",  
" \"FROM dp03_catalogs.MPCORB\")\n",  
" \"FROM dp03_catalogs_10yr.MPCORB\")\n",  
"results.to_table()"  
]  
},  
Expand Down Expand Up @@ -381,9 +385,7 @@  
"source": [  
"Execute the search, and retrieve all (\\\*) columns from the `MPCORB` table.\n",  
"\n",  
"Store the results in `df` as a `pandas` dataframe.\n",  
"\n",  
">**Notice:** Warnings will appear in pink, but they can be ignored as they will soon be correct."  
"Store the results in `df` as a `pandas` dataframe."  
]  
},  
{  
Expand All @@ -395,7 +397,7 @@  
},  
"outputs": [],  
"source": [  
"results = service.search(\"SELECT * FROM dp03_catalogs.MPCORB \"\n",  
"results = service.search(\"SELECT * FROM dp03_catalogs_10yr.MPCORB \"\n",  
" \"WHERE ssObjectId BETWEEN 9038903462544093184 \"\n",  
" \"AND 9223370875126069107\")\n",  
"df = results.to_table().to_pandas()"  
Expand Down Expand Up @@ -427,7 +429,7 @@  
"id": "528bd445-2510-4fbd-985e-f33c91f3e47f",  
"metadata": {},  
"source": [  
"As we see, 145,967 rows were returned, which -- _as expected_ -- is almost (but not exactly) 1% of the 14600302 rows in the `MPCORB` table. \n",  
"As we see, 144,472 rows were returned, which -- _as expected_ -- is almost (but not exactly) 1% of the 14,462,388 rows in the `MPCORB` table. \n",  
"\n",  
"> **Notice:** There are several columns that currently contain `NaN` (not a number) values.\n",  
"For the simulated DP0.3 data these columns might be replaced in the near future, \n",  
Expand Down Expand Up @@ -558,6 +560,8 @@  
"\n",  
"> **Notice:** no artifacts or spurious difference-image sources have been injected into the DP0.3 catalogs.\n",  
"\n",  
"> **Notice:** although there are columns for them, no _u-_ or _Y_-band data were simulated for DP0.3. Unless noted, we will ignore _u-_ or _Y_-band data for the remainder of this notebook.\n",  
"\n",  
"### 4.1. Size\n",  
"\n",  
"Use the ADQL count function to return the size."  
Expand All @@ -572,7 +576,7 @@  
},  
"outputs": [],  
"source": [  
"results = service.search(\"SELECT COUNT(*) from dp03_catalogs.SSObject\")\n",  
"results = service.search(\"SELECT COUNT(*) from dp03_catalogs_10yr.SSObject\")\n",  
"results.to_table().to_pandas()"  
]  
},  
Expand All @@ -581,9 +585,9 @@  
"id": "56f8dad2-5f9a-4393-960c-f652440ed3b1",  
"metadata": {},  
"source": [  
"The DP0.3 data set contains 10.2 million solar system objects detected by Rubin.\n",  
"The DP0.3 data set contains 4.4 million solar system objects detected by Rubin.\n",  
"\n",  
"This is less than the 14.6 million objects in the `MPCORB` catalog.\n",  
"This is less than the 14.5 million objects in the `MPCORB` catalog.\n",  
"It is left as an exercise for the learner in Section 7 to determine the characteristics of those \n",  
"objects from the `MPCORB` table are missing from the `SSObject` table."  
]  
Expand All @@ -609,7 +613,7 @@  
"source": [  
"# results = service.search(\"SELECT column_name, datatype, description, \"\n",  
"# \"unit from TAP_SCHEMA.columns \"\n",  
"# \"WHERE table_name = 'dp03_catalogs.SSObject'\")\n",  
"# \"WHERE table_name = 'dp03_catalogs_10yr.SSObject'\")\n",  
"# results.to_table().to_pandas()"  
]  
},  
Expand All @@ -632,7 +636,7 @@  
},  
"outputs": [],  
"source": [  
"results = service.search(\"SELECT * FROM dp03_catalogs.ssObject \"\n",  
"results = service.search(\"SELECT * FROM dp03_catalogs_10yr.ssObject \"\n",  
" \"WHERE ssObjectId BETWEEN 9038903462544093184 \"\n",  
" \"AND 9223370875126069107\")\n",  
"df = results.to_table().to_pandas()"  
Expand Down Expand Up @@ -664,7 +668,7 @@  
"tags": []  
},  
"source": [  
"There are 102261 rows."  
"There are 44611 rows."  
]  
},  
{  
Expand Down Expand Up @@ -707,9 +711,9 @@  
"### 4.4. Plot a color-color diagram\n",  
"\n",  
"In the displayed dataframe above, it appears that for many `SSObjects` the phase-curve fits to derive \n",  
"absolute magnitudes were not successful, as the `<f>H` (where `<f>` is a filter u, g, r, i, z, or y) are `NaN`.\n",  
"absolute magnitudes were not successful, as the `<band>_H` (where `<band>` is a band u, g, r, i, z, or y) are `NaN`. (Recall in particular that no _u-_ or _y_-band data were simulated for DP0.3.)\n",  
"\n",  
"Before calculating and plotting the colors, drop all of the rows for which the phase-curve fits were not successful."  
"Before calculating and plotting the colors, drop all of the rows for which the phase-curve fits were not successful for g, r, i, and/or z bands."  
]  
},  
{  
Expand All @@ -721,9 +725,9 @@  
},  
"outputs": [],  
"source": [  
"df.dropna(inplace=True)\n",  
"df.dropna(subset=['g_H', 'r_H', 'i_H', 'z_H'], inplace=True)\n",  
"df.reset_index(inplace=True)\n",  
"print('Number of rows after dropping all rows with NaNs: %d' % len(df))"  
"print('Number of rows after dropping rows: %d' % len(df))"  
]  
},  
{  
Expand Down Expand Up @@ -751,11 +755,9 @@  
},  
"outputs": [],  
"source": [  
"df['ug'] = df['uH'] - df['gH']\n",  
"df['gr'] = df['gH'] - df['rH']\n",  
"df['ri'] = df['rH'] - df['iH']\n",  
"df['iz'] = df['iH'] - df['zH']\n",  
"df['zy'] = df['zH'] - df['yH']"  
"df['gr'] = df['g_H'] - df['r_H']\n",  
"df['ri'] = df['r_H'] - df['i_H']\n",  
"df['iz'] = df['i_H'] - df['z_H']"  
]  
},  
{  
Expand All @@ -775,23 +777,26 @@  
},  
"outputs": [],  
"source": [  
"fig, ax = plt.subplots(2, 2, figsize=(8, 6))\n",  
"h = ax[0, 0].hist2d(df['ug'], df['gr'], bins=100, norm='log')\n",  
"ax[0, 0].set_xlabel('u - g')\n",  
"ax[0, 0].set_ylabel('g - r')\n",  
"plt.colorbar(h[3])\n",  
"h = ax[0, 1].hist2d(df['gr'], df['ri'], bins=100, norm='log')\n",  
"ax[0, 1].set_xlabel('g - r')\n",  
"ax[0, 1].set_ylabel('r - i')\n",  
"plt.colorbar(h[3])\n",  
"h = ax[1, 0].hist2d(df['ri'], df['iz'], bins=100, norm='log')\n",  
"ax[1, 0].set_xlabel('r - i')\n",  
"ax[1, 0].set_ylabel('i - z')\n",  
"fig, ax = plt.subplots(1, 2, figsize=(8, 3))\n",  
"\n",  
"h = ax[0].hist2d(df['gr'], df['ri'],\n",  
" bins=(np.arange(-0.5, 1.5, 0.01),\n",  
" np.arange(-0.5, 0.75, 0.01)),\n",  
" norm='log')\n",  
"ax[0].set_xlabel('g - r')\n",  
"ax[0].set_ylabel('r - i')\n",  
"ax[0].grid()\n",  
"plt.colorbar(h[3])\n",  
"h = ax[1, 1].hist2d(df['iz'], df['zy'], bins=100, norm='log')\n",  
"ax[1, 1].set_xlabel('i - z')\n",  
"ax[1, 1].set_ylabel('z - y')\n",  
"\n",  
"h = ax[1].hist2d(df['ri'], df['iz'],\n",  
" bins=(np.arange(-0.5, 0.75, 0.01),\n",  
" np.arange(-0.75, 0.5, 0.01)),\n",  
" norm='log')\n",  
"ax[1].set_xlabel('r - i')\n",  
"ax[1].set_ylabel('i - z')\n",  
"ax[1].grid()\n",  
"plt.colorbar(h[3])\n",  
"\n",  
"fig.suptitle('Color-Color Plots for the SSObject Catalog')\n",  
"fig.tight_layout()\n",  
"plt.show()"  
Expand All @@ -802,8 +807,7 @@  
"id": "653f251d-a172-4cda-b3c5-0aeecf28d8e6",  
"metadata": {},  
"source": [  
"There are only two populations of colors in the simulation - but this is not the case for real Solar System objects.\n",  
"These plots will look very different in the future, when they are made with real Rubin data."  
"There are basically only two main populations of colors in the simulation - but this is not the case for real Solar System objects. These plots will look very different in the future, when they are made with real Rubin data."  
]  
},  
{  
Expand Down Expand Up @@ -841,7 +845,7 @@  
},  
"outputs": [],  
"source": [  
"results = service.search(\"SELECT COUNT(*) from dp03_catalogs.SSSource\")\n",  
"results = service.search(\"SELECT COUNT(*) from dp03_catalogs_10yr.SSSource\")\n",  
"results.to_table().to_pandas()"  
]  
},  
Expand All @@ -850,7 +854,7 @@  
"id": "47b9a7c5-4f38-42f3-96b8-732c72010b81",  
"metadata": {},  
"source": [  
"**_This table contains over a billion sources!_**"  
"**_This table contains over a 653 million sources!_**"  
]  
},  
{  
Expand All @@ -874,8 +878,8 @@  
"source": [  
"# results = service.search(\"SELECT column_name, datatype, description, \"\n",  
"# \"unit from TAP_SCHEMA.columns \"\n",  
"# \"WHERE table_name = 'dp03_catalogs.SSSource'\")\n",  
"results.to_table().to_pandas()"  
"# \"WHERE table_name = 'dp03_catalogs_10yr.SSSource'\")\n",  
"# results.to_table().to_pandas()"  
]  
},  
{  
Expand All @@ -890,7 +894,7 @@  
"use a query such as: \n",  
"\n",  
"```\n",  
"SELECT * FROM dp03_catalogs.SSSource\n",  
"SELECT * FROM dp03_catalogs_10yr.SSSource\n",  
"WHERE ssObjectId BETWEEN 9038903462544093184 AND 9223370875126069107\n",  
"```\n",  
"\n",  
Expand All @@ -911,7 +915,7 @@  
"source": [  
"results = service.search(\"SELECT heliocentricX, heliocentricY, \"\n",  
" \"topocentricX, topocentricY, ssObjectId \"\n",  
" \"FROM dp03_catalogs.SSSource \"\n",  
" \"FROM dp03_catalogs_10yr.SSSource \"\n",  
" \"WHERE ssObjectId = 6793512588511170680\")\n",  
"df_xy = results.to_table().to_pandas()\n",  
"print('Retrieved ', len(df_xy), ' rows.')"  
Expand Down Expand Up @@ -1058,8 +1062,8 @@  
},  
"outputs": [],  
"source": [  
"# results = service.search(\"SELECT COUNT(*) from dp03_catalogs.DiaSource\")\n",  
"# results.to_table().to_pandas()"  
"# results = service.search(\"SELECT COUNT(*) from dp03_catalogs_10yr.DiaSource\")\n",  
"# results.to_table().to_pandas()\n"  
]  
},  
{  
Expand All @@ -1083,7 +1087,7 @@  
"source": [  
"# results = service.search(\"SELECT column_name, datatype, description, \"\n",  
"# \"unit from TAP_SCHEMA.columns \"\n",  
"# \"WHERE table_name = 'dp03_catalogs.DiaSource'\")\n",  
"# \"WHERE table_name = 'dp03_catalogs_10yr.DiaSource'\")\n",  
"# results.to_table().to_pandas()"  
]  
},  
Expand All @@ -1098,7 +1102,7 @@  
"use a query such as: \n",  
"\n",  
"```\n",  
"SELECT * FROM dp03_catalogs.DiaSource\n",  
"SELECT * FROM dp03_catalogs_10yr.DiaSource\n",  
"WHERE ssObjectId BETWEEN 9038903462544093184 AND 9223370875126069107\n",  
"```\n",  
"\n",  
Expand All @@ -1117,10 +1121,12 @@  
},  
"outputs": [],  
"source": [  
"results = service.search(\"SELECT ra, decl, mag, filter, midPointTai \"\n",  
" \"FROM dp03_catalogs.DiaSource \"\n",  
"results = service.search(\"SELECT ra, dec, mag, band, midpointMjdTai \"\n",  
" \"FROM dp03_catalogs_10yr.DiaSource \"\n",  
" \"WHERE ssObjectId = 6793512588511170680\")\n",  
"df = results.to_table().to_pandas()"  
"df = results.to_table().to_pandas()\n",  
"\n",  
"df"  
]  
},  
{  
Expand Down Expand Up @@ -1149,9 +1155,9 @@  
"source": [  
"cmap = colormaps['viridis']\n",  
"fig, ax = plt.subplots(1, 1, figsize=(12, 3))\n",  
"im = ax.scatter(df['ra'], df['decl'], c=df['midPointTai'], cmap=cmap)\n",  
"im = ax.scatter(df['ra'], df['dec'], c=df['midpointMjdTai'], cmap=cmap)\n",  
"ax.set_xlabel('ra (deg)')\n",  
"ax.set_ylabel('decl (deg)')\n",  
"ax.set_ylabel('dec (deg)')\n",  
"fig.suptitle(\"Path of one SSObject in equatorial coordinates over 10 years\")\n",  
"fig.subplots_adjust(right=0.8)\n",  
"cbar_ax = fig.add_axes([0.85, 0.15, 0.02, 0.7])\n",  
Expand Down  
  
Toggle all file notes Toggle all file annotations

###  0 comments on commit `0ef6550`

Please sign in to comment. 

## Footer

Â© 2024 GitHub, Inc. 

### Footer navigation

  * Terms
  * Privacy
  * Security
  * Status
  * Docs
  * Contact
  * Manage cookies 
  * Do not share my personal information 



You canâ€™t perform that action at this time. 
